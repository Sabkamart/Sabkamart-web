<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Create Own Item</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #ffffff;
      margin: 0;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .category-box {
      display: flex;
      gap: 15px;
      margin-bottom: 20px;
      align-items: center;
    }

    /* Standard select styling for category */
    .category-box select {
      padding: 10px 14px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background: #f9f9f9;
      min-width: 180px;
      cursor: pointer;
      height: 42px;
      box-sizing: border-box;
    }

    .container {
      width: 400px;
      padding: 20px;
      border: 1px solid #eee;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      background-color: #fff;
    }

    .radio-group {
      display: flex;
      justify-content: space-around;
      margin-bottom: 15px;
    }

    .radio-group input {
      margin-right: 5px;
    }

    .form-group {
      margin-bottom: 15px;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .quantity-group {
      display: flex;
      gap: 10px;
    }

    .quantity-group input {
      flex: 1;
    }

    #unit {
      width: 50%;
      padding: 10px;
      font-size: 16px;
      box-sizing: border-box;
      border-radius: 6px;
      border: 1px solid #ccc;
      color: #555;
      background-color: #fff;
    }

    .btn-save {
      width: 100%;
      padding: 12px;
      background-color: #ffc107;
      border: none;
      font-size: 18px;
      font-weight: bold;
      cursor: pointer;
      border-radius: 6px;
    }

    .btn-save:hover {
      background-color: #e0a800;
    }

    .btn-save:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }

    .alert {
      margin-top: 15px;
      padding: 12px;
      border-radius: 4px;
      font-weight: bold;
      display: none;
    }

    .alert.success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert.error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .alert.loading {
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    /* Select2 Styling to match regular selects */
    .select2-container {
      min-width: 180px !important;
      box-sizing: border-box;
    }

    .select2-container--default .select2-selection--single {
      font-size: 16px !important;
      border: 1px solid #ccc !important;
      border-radius: 8px !important;
      background: #f9f9f9 !important;
      cursor: pointer;
      height: 42px !important;
      box-sizing: border-box !important;
      padding: 0 !important;
      line-height: 42px !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
      padding-left: 12px !important;
      padding-right: 30px !important;
      line-height: 42px !important;
      color: #333 !important;
      margin: 0 !important;
      height: 42px !important;
      display: block !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 42px !important;
      top: 0 !important;
      right: 8px !important;
      width: 20px !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow b {
      top: 50% !important;
      transform: translateY(-50%) !important;
    }

    /* Ensure both selects have same appearance when disabled */
    .select2-container--default.select2-container--disabled .select2-selection--single {
      background-color: #e9ecef;
      cursor: not-allowed;
      color: #6c757d;
    }

    .select2-container {
      z-index: 9999 !important;
    }

    /* Fix placeholder styling */
    .select2-container--default .select2-selection--single .select2-selection__placeholder {
      color: #6c757d;
    }
  </style>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
</head>
<body>

<form id="productForm">
  <div class="category-box">
    <select name="category" id="category" required>
      <option value="">Select Category</option>
      <option value="Kitchen & Grocery">Kitchen & Grocery</option>
      <option value="Household Essentials">Household Essentials</option>
      <option value="Snacks & Drinks">Snacks & Drinks</option>
      <option value="Other Home Needs">Other Home Needs</option>
      <option value="Stationary">Stationary</option>
    </select>

    <select name="subcategory" id="subcategory" disabled required>
      <option value="">Select SubCategory</option>
    </select>
  </div>

  <div class="container">
    <div class="radio-group">
      <label><input type="radio" name="itemType" value="brand" required> Brand Item</label>
      <label><input type="radio" name="itemType" value="loose" required> Loose Item</label>
    </div>

    <div class="form-group">
      <input type="text" name="barcode" id="barcode" placeholder="BarCode Number" required>
    </div>
    <div class="form-group">
      <input type="text" name="brand" id="brand" placeholder="Enter Brand Name" required>
    </div>
    <div class="form-group">
      <input type="text" name="product" id="product" placeholder="Enter Product Full Name" required>
    </div>

    <div class="form-group quantity-group">
      <input type="text" name="quantity" id="quantity" placeholder="Enter Quantity" required>
      <select name="unit" id="unit" required>
        <option value="">Select Unit</option>
        <option value="Kg">Kg</option>
        <option value="g">g</option>
        <option value="L">L</option>
        <option value="ml">ml</option>
        <option value="Pieces">Pieces</option>
        <option value="Combo">Combo</option>
        <option value="Pack">Pack</option>
        <option value="Sheets">Sheets</option>
      </select>
    </div>

    <button type="submit" class="btn-save" id="saveBtn">Submit</button>
    
    <div id="alertBox" class="alert"></div>
  </div>
</form>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<script>
  // Category to Subcategory mapping
  const categoryMap = {
    "Household Essentials": ["Toilet Cleaners", "Floor Cleaners", "Soaps", "Face Creams", "Shampoo", "Tooth Paste", "Hair Oil", "Body Lotion", "Detergent Powder", "Basic Pharma", "Handwash & Sanitizer", "Hair Removals", "Sanitary Pads", "Tooth Brush", "Detergent Bars", "Fabric Care", "Conditioner", "Body Washes", "Face Powders", "Face Wash & Scrub", "Liquid Detergents", "Utensils Cleaners", "Baby Care"],
    "Kitchen & Grocery": ["Ground Nut", "Toor Dal", "Honey", "Wheat Flour", "Tea Powder", "Local Rice", "Dry Coconut", "Jaggery", "Salt", "Sugar", "Basmati Rice", "Semiya", "Garlic", "Eggs", "Tamarind", "Ghee", "Red Mirchi", "Tumeric", "Chicken & Garam Masala", "Ginger Garlic Paste", "Other Masalas", "Dates", "Cashew Nuts", "Almond & Pista", "Raisins", "Other Dry Fruits", "Mango", "Lemon & Tomato", "Other Pickles", "Sunflower Oil", "Groundnut Oil", "Coffee Powder", "Healthy Drinks", "Other Oils", "Papads", "Poha", "Gram Flour", "Maida", "Other Flours", "Chana Dal", "Phutana", "Other Dals", "Upma Rava", "Idli Rava", "Bombay Rava", "Baking Soda", "Jeera", "Jeera & Mustard Seeds", "Dalchini Sticks & Somp", "Coriander & Pepper seeds", "Other Spi", "Milk Maid", "Gulab Jamun", "Saffron", "Peni Rava", "Other Sweets", "Oats"],
    "Other Home Needs": ["Cloth Clips", "Battery Cell", "Betel Nut", "Rangoli Powder", "CowDung Powder", "Ear Buds", "Toothpick Sticks", "Mouth Freshner", "Candles", "Match Box", "Plastic Bag", "Tissue Papers", "Agarbatti", "Coconut", "Camphor & Sambrani", "Kumkum & Vibhuti", "Deepa Oil & Diyabatti", "Broom", "Mop", "Home", "Bathroom", "Mosquito", "Cockroach", "Rat", "Ant", "Other", "Plates", "Glasses", "Cups & Spoons", "Paper Rolls", "Aluminium Foil", "Foil Container"],
    "Snacks & Drinks": ["Soft Drinks", "Cookies", "Chips", "Tubs & Party Packs", "Pasta", "Bhujia & Namkeens", "Indian Snacks", "Sweets", "Jam", "Ketchup", "Spreads & Dips", "Instant Noodles", "Cup Noodles", "Korean Noodles", "Hakka Noodles", "Other Noodles", "Energy Drinks", "Juices & Fruit Drinks", "Cones & Sticks", "Kulfi", "Cups", "Other Ice Creams", "Soups", "Cheese", "Butter", "Paneer", "Buns", "Cadbury", "Nestle", "Amul", "Other Chocolates", "Marie & Digestive", "Cream Biscuits", "Cakes & Pies", "Rusk"],
    "Stationary": ["Books", "Fevi Sticks & Gums", "Stapler & Pins", "Cello Tape", "Chalks", "Pens & Pencils", "Sketch Pens & Glitters", "Files", "Geometry Box", "Exam Pad", "Color Pens & Paint", "Pen Holder"]
  };

  const alertBox = document.getElementById('alertBox');
  const saveBtn = document.getElementById('saveBtn');

  function showAlert(message, type) {
    alertBox.className = `alert ${type}`;
    alertBox.textContent = message;
    alertBox.style.display = 'block';
    
    if (type === 'success') {
      setTimeout(() => {
        alertBox.style.display = 'none';
      }, 3000);
    }
  }

  // Form validation
  function validateForm(formData) {
    const requiredFields = ['category', 'subcategory', 'itemType', 'barcode', 'brand', 'product', 'quantity', 'unit'];
    
    for (let field of requiredFields) {
      if (!formData.get(field) || formData.get(field).trim() === '') {
        showAlert(`Please fill in the ${field.replace(/([A-Z])/g, ' $1').toLowerCase()} field`, 'error');
        return false;
      }
    }
    return true;
  }

  // Initialize when DOM is ready
  $(document).ready(function() {
    // Initialize Select2 for subcategory with proper configuration
    $('#subcategory').select2({
      placeholder: 'Select SubCategory',
      allowClear: false,
      width: '100%'
    });

    console.log('Select2 initialized');

    // Category change handler
    $('#category').on('change', function() {
      const selectedCategory = $(this).val();
      console.log('Selected category:', selectedCategory);
      
      // Clear subcategory dropdown
      $('#subcategory').empty().append('<option value="">Select SubCategory</option>');
      
      if (selectedCategory && categoryMap[selectedCategory]) {
        // Enable subcategory dropdown
        $('#subcategory').prop('disabled', false);
        
        // Add subcategory options
        categoryMap[selectedCategory].forEach(function(subcategory) {
          $('#subcategory').append(new Option(subcategory, subcategory));
        });
        
        console.log('Added subcategories:', categoryMap[selectedCategory].length);
      } else {
        // Disable subcategory dropdown
        $('#subcategory').prop('disabled', true);
      }
      
      // Refresh Select2
      $('#subcategory').trigger('change');
    });

    console.log('Category change handler attached');
  });

  // Form submission
  document.getElementById('productForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    
    const formData = new FormData(this);
    
    // Validate form
    if (!validateForm(formData)) {
      return;
    }

    // Disable button and show loading
    saveBtn.disabled = true;
    saveBtn.textContent = 'Saving...';
    showAlert('Saving product...', 'loading');

    try {
      // Prepare data object
      const data = {
        category: formData.get('category'),
        subcategory: formData.get('subcategory'),
        itemType: formData.get('itemType'),
        barcode: formData.get('barcode'),
        brand: formData.get('brand'),
        product: formData.get('product'),
        quantity: formData.get('quantity'),
        unit: formData.get('unit'),
        timestamp: new Date().toISOString()
      };

      console.log('Sending data:', data);

      // Send to Google Apps Script
      const response = await fetch('https://script.google.com/macros/s/AKfycbxGjpy-K7ujyqp8xvOO7da7TkZoCjICt2-QULAwjXQUQVoTvzeGMxAy9VK7xQJU_Vz6/exec', {
        method: 'POST',
        mode: 'no-cors',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
      });

      console.log('Response received:', response);
      
      showAlert('Product saved successfully!', 'success');
      
      // Reset form
      document.getElementById('productForm').reset();
      $('#subcategory').empty().append('<option value="">Select SubCategory</option>');
      $('#subcategory').prop('disabled', true).trigger('change');

    } catch (error) {
      console.error('Submission error:', error);
      showAlert(`Error saving product: ${error.message}`, 'error');
    } finally {
      // Re-enable button
      saveBtn.disabled = false;
      saveBtn.textContent = 'Save';
    }
  });
</script>

</body>
</html>